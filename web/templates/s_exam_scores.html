<!DOCTYPE html>
<html>
<head>
    <title>学生考试成绩</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- 导入 Chart.js 库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script> <!-- 导入 Moment.js 库 -->
</head>
<body>
    <h1>学生考试成绩</h1>

    <!-- 表格显示历史考试成绩 -->
    <h2>历史考试成绩</h2>
    <table>
        <thead>
            <tr>
                <th>考试时间</th>
                <th>考试类型</th>
                <th>语文</th>
                <th>数学</th>
                <th>物理</th>
                <th>化学</th>
                <th>英语</th>
                <th>生物</th>
                <th>政治</th>
                <th>历史</th>
                <th>地理</th>
                <th>总分</th>
                <th>备注</th>
            </tr>
        </thead>
        <tbody>
            {% for exam_score in exam_scores|dictsort:"exam_time" %}
                <tr>
                    <td>{{ exam_score.exam_time }}</td>
                    <td>{{ exam_score.exam_type }}</td>
                    <td>{{ exam_score.chinese }}</td>
                    <td>{{ exam_score.math }}</td>
                    <td>{{ exam_score.physics }}</td>
                    <td>{{ exam_score.chemistry }}</td>
                    <td>{{ exam_score.english }}</td>
                    <td>{{ exam_score.biology }}</td>
                    <td>{{ exam_score.politics }}</td>
                    <td>{{ exam_score.history }}</td>
                    <td>{{ exam_score.geography }}</td>
                    <td>{{ exam_score.total }}</td>
                    <td>{{ exam_score.remarks }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- 图表显示历史成绩趋势 -->
    <h2>历史成绩趋势</h2>
    <canvas id="totalChart" width="400" height="200"></canvas> <!-- Canvas 元素用于显示总分图表 -->
    <canvas id="subjectChart" width="400" height="200"></canvas> <!-- Canvas 元素用于显示其他学科图表 -->

    <script>
        // 获取历史考试成绩数据
        var examScores = [
            {% for exam_score in exam_scores %}
                { 
                    chinese: {{ exam_score.chinese }},
                    math: {{ exam_score.math }},
                    physics: {{ exam_score.physics }},
                    chemistry: {{ exam_score.chemistry }},
                    english: {{ exam_score.english }},
                    biology: {{ exam_score.biology }},
                    politics: {{ exam_score.politics }},
                    history: {{ exam_score.history }},
                    geography: {{ exam_score.geography }},
                    total: {{ exam_score.total }},
                    examTime: '{{ exam_score.exam_time }}'
                },
            {% endfor %}
        ];
        // 先按照考试时间排序
        examScores.sort(function(a, b) {
            return moment(a.examTime, "MMMM D, YYYY, h:mm:ss a").toDate() - moment(b.examTime, "MMMM D, YYYY, h:mm:ss a").toDate();
        });

        var parsedDates = examScores.map(function(examScore) {
            return moment(examScore.examTime, "MMMM D, YYYY, h:mm:ss a").format("YYYY-MM-DD");
        });


        // 使用 Chart.js 创建总分图表
        var totalCtx = document.getElementById('totalChart').getContext('2d');
        var totalChart = new Chart(totalCtx, {
            type: 'line',
            data: {
                labels: parsedDates,
                datasets: [{
                    label: '总分',
                    data: examScores.map(function(score) { return score.total; }),
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        suggestedMax: 100 // 设置纵轴最大值为 100
                    }
                }
            }
        });

        // 使用 Chart.js 创建其他学科图表
        var subjectCtx = document.getElementById('subjectChart').getContext('2d');
        var subjectChart = new Chart(subjectCtx, {
            type: 'line',
            data: {
                labels: parsedDates,

                datasets: [
                    {
                        label: '语文',
                        data: examScores.map(function(score) { return score.chinese; }),
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: '数学',
                        data: examScores.map(function(score) { return score.math; }),
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: '物理',
                        data: examScores.map(function(score) { return score.physics; }),
                        borderColor: 'rgba(255, 206, 86, 1)',
                        backgroundColor: 'rgba(255, 206, 86, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: '化学',
                        data: examScores.map(function(score) { return score.chemistry; }),
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: '英语',
                        data: examScores.map(function(score) { return score.english; }),
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: '生物',
                        data: examScores.map(function(score) { return score.biology; }),
                        borderColor: 'rgba(255, 159, 64, 1)',
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: '政治',
                        data: examScores.map(function(score) { return score.politics; }),
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: '历史',
                        data: examScores.map(function(score) { return score.history; }),
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.1
                    },
                    {
                        label: '地理',
                        data: examScores.map(function(score) { return score.geography; }),
                        borderColor: 'rgba(255, 206, 86, 1)',
                        backgroundColor: 'rgba(255, 206, 86, 0.2)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        suggestedMax: 100 // 设置纵轴最大值为 100
                    }
                }
            }
        });
    </script>
</body>
</html>

